// Generated by CoffeeScript 1.10.0
(function() {
  $(function() {
    var curParentId, fileToMove, folderToMove, getTree, getTreeFiles;
    $.ajaxSetup({
      headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
      }
    });
    $(".admin_delete").on('click', function() {
      var url;
      url = $(this).attr("href");
      if (confirm("Вы уверены?")) {
        $.ajax({
          url: url,
          type: 'post',
          data: {
            _method: 'delete'
          },
          success: function(data) {
            return window.location.reload();
          }
        });
      }
      return false;
    });
    $('.context').contextmenu();
    $("#folders").on('click', '.delete_folder', function() {
      var url;
      url = $(this).attr("data-url");
      if (confirm("Вы уверены?")) {
        $.ajax({
          url: url,
          type: 'post',
          data: {
            _method: 'delete'
          },
          success: function(data) {
            return window.location.reload();
          }
        });
      }
      return false;
    });
    $("#folders").on('click', '.rename_folder', function() {
      var id;
      id = $(this).attr('data-id');
      $("#folder_" + id + " .folder_name").hide();
      $("#folder_" + id + " .folder_rename_input").show();
      $("#context-menu-" + id).hide();
      return false;
    });
    $("#folders").on('click', '.folder_rename_input', function(event) {
      event.stopPropagation();
      return false;
    });
    $(document).on('blur', '.folder_rename_input', function(e) {
      return $(document).click();
    });
    $(document).on('click', function(e) {
      if (!$(e.target).is('.folder_rename_input')) {
        $("body").find(".folder_rename_input").not(":hidden").each(function() {
          var $this, id, method, name, parent_id, url;
          id = $(this).attr('data-id');
          name = $(this).val();
          url = $(this).attr('data-url');
          method = $(this).attr('data-method');
          parent_id = $('#folders').attr('data-parent-id');
          $this = $(this);
          return $.ajax({
            url: url,
            type: 'post',
            data: {
              _method: method,
              id: id,
              name: name,
              description: name,
              parent_id: parent_id
            },
            success: function(data) {
              $this.parents('.folder_container').replaceWith(data);
              return $('.context').contextmenu();
            }
          });
        });
        $("#folders .folder_rename_input").hide();
        return $('#folders .folder_name').show();
      }
    });
    $(".add_folder").on('click', function() {
      var html;
      html = $('#clone_folder').html();
      $('#folders').append(html);
      $('#folders .folder_container').last().find('input').focus();
      return false;
    });
    folderToMove = 0;
    $('#folders').on('click', '.move_folder', function() {
      var id;
      id = $(this).attr('data-id');
      folderToMove = id;
      $("#context-menu-" + id).hide();
      getTree();
      return false;
    });
    fileToMove = 0;
    $('#folders').on('click', '.move_file', function() {
      var id;
      id = $(this).attr('data-id');
      fileToMove = id;
      $("#context-menu-" + id).hide();
      getTreeFiles();
      return false;
    });
    curParentId = $('#folders').attr('data-parent-id');
    getTree = function() {
      return $.ajax({
        url: $('#folders').attr('data-get-tree-url'),
        type: 'get',
        dataType: 'json'
      }).done(function(data) {
        $('#tree').treeview({
          data: data,
          onNodeSelected: function(event, data) {
            return curParentId = data.id;
          }
        });
        return $('#treeModal').modal('show');
      });
    };
    $('.select_category').click(function() {
      $.ajax({
        url: "/folders/" + folderToMove + "/edit",
        type: 'post',
        data: {
          _method: 'put',
          id: folderToMove,
          parent_id: curParentId,
          is_ajax: 'Y'
        }
      }).done(function(data) {
        return window.location.reload();
      });
      return false;
    });
    getTreeFiles = function() {
      return $.ajax({
        url: $('#folders').attr('data-get-tree-url'),
        type: 'get',
        dataType: 'json'
      }).done(function(data) {
        $('#treeFiles').treeview({
          data: data,
          onNodeSelected: function(event, data) {
            return curParentId = data.id;
          }
        });
        return $('#treeFilesModal').modal('show');
      });
    };
    $('.select_category_for_file').click(function() {
      $.ajax({
        url: "/files/" + fileToMove + "/edit",
        type: 'post',
        data: {
          _method: 'put',
          id: fileToMove,
          folder_id: curParentId,
          is_ajax: 'Y'
        }
      }).done(function(data) {
        return window.location.reload();
      });
      return false;
    });
    $('.add_file').click(function() {
      var $this;
      $this = $(this);
      $.ajax({
        url: $this.attr('data-url'),
        type: 'get'
      }).done(function(data) {
        $('#file_add_contaier').html(data);
        return $('#filesModal').modal('show');
      });
      return false;
    });
    $(document).on('click', '.save_file', function() {
      if ($("#file").val() === '') {
        $('#file-errors').show();
        return false;
      }
      if ($("#file_name").val() === '') {
        $('#file-errors').show();
        return false;
      }
      $('#file-errors').hide();
      $('#file_upload_form input[name=folder_id]').val($('#folders').attr('data-parent-id'));
      $('#file_upload_form').submit();
      return false;
    });
    return $('body').on('click', '.update_file', function() {
      var $this, id;
      id = $(this).attr('data-id');
      $("#context-menu-" + id).hide();
      $this = $(this);
      $.ajax({
        url: $this.attr('data-url'),
        type: 'get'
      }).done(function(data) {
        $('#file_add_contaier').html(data);
        return $('#filesModal').modal('show');
      });
      return false;
    });
  });

}).call(this);

//# sourceMappingURL=script.js.map
